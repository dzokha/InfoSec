CREATE TABLE PHONG
    (
      MAPHONG CHAR(10) PRIMARY KEY ,
      TENPHONG NVARCHAR(40) NOT NULL ,
      DIACHI NVARCHAR(50) NOT NULL ,
      TEL CHAR(10)
    )
GO

CREATE TABLE DMNN
    (
      MANN CHAR(10) ,
      TENNN NVARCHAR(20) NOT NULL ,
      PRIMARY KEY ( MANN )
    )
GO

CREATE TABLE NHANVIEN
    (
      MANV CHAR(10) NOT NULL ,
      HOTEN NVARCHAR(40) NOT NULL ,
      GIOITINH CHAR(3) NOT NULL ,
      NGAYSINH DATE NOT NULL ,
      LUONG INT NOT NULL ,
      MAPHONG CHAR(10)  ,
      SDT CHAR(10) ,
      NGAYBC DATE
    )

ALTER TABLE dbo.NHANVIEN ADD CONSTRAINT nv_pk PRIMARY KEY (MANV)
ALTER TABLE dbo.NHANVIEN ADD CONSTRAINT nv_fk FOREIGN KEY (MAPHONG) REFERENCES dbo.PHONG(MAPHONG)
GO

CREATE TABLE TDNN
    (
      MANV CHAR(10) NOT NULL
                   FOREIGN KEY REFERENCES dbo.NHANVIEN ( MANV ) ,
      MANN CHAR(10) NOT NULL
                   FOREIGN KEY REFERENCES dbo.DMNN ( MANN ) ,
      TDO NVARCHAR(50) NOT NULL ,
      PRIMARY KEY ( MANV, MANN )
    )
GO
INSERT INTO DMNN (MANN, TENNN) values
('EN', 'Ti?ng Anh'),
('JP', 'Ti?ng Nh?t'),
('ER', 'Ti?ng Pháp'),
('KR', 'Ti?ng Hàn'),
('CN', 'Ti?ng Trung');

INSERT INTO PHONG (MAPHONG, TENPHONG, DIACHI, TEL) VALUES
('P001', 'Phòng K? Toán', 'Phòng 101', '0281234567'),
('P002', 'Phòng Nhân S?', 'Phòng 102', '0289876543'),
('P003', 'Phòng IT', 'Phòng 202', '0287654321'),
('P004', 'Phòng Marketing','Phòng 205','0286543210');

INSERT INTO NHANVIEN (MANV, HOTEN, GIOITINH, NGAYSINH, LUONG, MAPHONG, SDT, NGAYBC) VALUES
('KT001', 'Nguy?n V?n An', 'Nam', '1995-03-15', 15000000, 'P001', '0912345678', '2020-01-01'),
('KT002', 'Lê Th? Bích Ng?c', 'N?', '1998-07-20', 12000000, 'P001', '0923456789', '2021-06-15'),
('KT003', 'Tr?n V?n Nam', 'Nam', '1993-11-05', 18000000, 'P003', '0934567890', '2019-03-10'),
('KT004', 'Nguy?n Th? Linh','N?','2000-02-28',11000000,'P001','0945678901','2022-09-01'),
('KT005', 'Ph?m Huy Quân','Nam','1900-12-10',20000000,'P002','0956789012','2018-12-20'),
('KT006', 'Nguy?n V?n Tùng','Nam','1992-04-18',17000000,NULL,'0945678901',NULL),
('KT007', 'H? Th? H?i','N?','1988-09-25',22000000,'P004','0978901234','2017-05-05'),
('KT008', '?? Minh Hoàng','Nam','1997-01-30',13000000,'P003','0989012345','2016-11-11'),
('KT009', 'Lê V?n V?n','Nam','1985-06-12',24000000,'P004','0990123456','2015-08-08'),
('KT010', 'Bùi Gia Ng?c','Nam','1999-10-14',12500000,'P002','0901234567','2014-10-20');

INSERT INTO TDNN ( MANV, MANN,TDO) VALUES
('KT001', 'ER', '??n v? 1'),
('KT002', 'JP', '??n v? 2'),
('KT003', 'ER', '??n v? 3'),
('KT004', 'KR', '??n v? 4'),
('KT005', 'CN', '??n v? 5');

/*1*/
SELECT *
FROM NHANVIEN
WHERE MANV = 'KT001';
/*2*/
SELECT *
FROM NHANVIEN
WHERE GIOITINH = 'N?';
/*3*/
SELECT *
FROM NHANVIEN
WHERE HOTEN LIKE 'Nguy?n%';
/*4*/
SELECT *
FROM NHANVIEN
WHERE HOTEN LIKE '%V?n%';
/*5*/
SELECT *, (YEAR(GETDATE()) - YEAR(NGAYSINH)) AS Tuoi
FROM NHANVIEN
WHERE (YEAR(GETDATE()) - YEAR(NGAYSINH)) < 30;
/*6*/
SELECT *, (YEAR(GETDATE()) - YEAR(NGAYSINH)) AS Tuoi
FROM NHANVIEN
WHERE (YEAR(GETDATE()) - YEAR(NGAYSINH)) BETWEEN 25 AND 30;
SELECT *
FROM NHANVIEN
WHERE YEAR(NGAYBC) < 2000;
/*9*/
SELECT *
FROM NHANVIEN
WHERE YEAR(GETDATE()) - YEAR(NGAYBC) > 10;
/*10*/
SELECT *
FROM NHANVIEN
WHERE (GIOITINH = 'Nam' AND YEAR(GETDATE()) - YEAR(NGAYSINH) >= 60)
   OR (GIOITINH = 'Nu' AND YEAR(GETDATE()) - YEAR(NGAYSINH) >= 55);
/*11*/
SELECT MAPHONG, TENPHONG, TEL
FROM PHONG;
/*12*/
SELECT TOP 3 HOTEN, NGAYSINH, NGAYBC
FROM NHANVIEN;
/*13*/
SELECT TOP 2 HOTEN, NGAYSINH, NGAYBC
FROM NHANVIEN;
/*14*/
SELECT *
FROM NHANVIEN
WHERE SDT IS NULL;
/*15*/
SELECT *
FROM NHANVIEN
WHERE MONTH(NGAYSINH) = 3;
/*16*/
SELECT *
FROM NHANVIEN
ORDER BY LUONG ASC;
/*17*/
SELECT AVG(LUONG)
FROM NHANVIEN
WHERE MAPHONG = (SELECT MAPHONG FROM PHONG WHERE TENPHONG = 'Kinh doanh');
/*18*/
SELECT COUNT(*) AS TongSoNhanVien, AVG(LUONG) AS LuongTrungBinh
FROM NHANVIEN
WHERE MAPHONG = (SELECT MAPHONG FROM PHONG WHERE TENPHONG = 'Kinh doanh');
/*19*/
SELECT MAPHONG, SUM(LUONG) AS TongLuong
FROM NHANVIEN
GROUP BY MAPHONG;
/*20*/
SELECT NV.*, P.TENPHONG, P.DIACHI, P.TEL
FROM NHANVIEN NV
LEFT JOIN PHONG P ON NV.MAPHONG = P.MAPHONG;
/*21*/
SELECT SUM(LUONG) AS TongLuongCongTy
FROM NHANVIEN;
/*22*/
SELECT *
FROM NHANVIEN
WHERE LUONG = (SELECT MAX(LUONG) FROM NHANVIEN);
/*23*/
SELECT TOP 1 P.TENPHONG
FROM NHANVIEN NV
JOIN PHONG P ON NV.MAPHONG = P.MAPHONG
GROUP BY P.TENPHONG
ORDER BY SUM(NV.LUONG) DESC;



